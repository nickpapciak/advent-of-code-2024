import marimo

__generated_with = "0.9.26"
app = marimo.App(width="medium")


@app.cell
def __():
    data = """........#.............................................#.........#..............#.......#....................#....................#
    ......................#........#........................#.............##............................#.#.............#..........#..
    ....#..................................#..................#.........#....#..............#..#......................#........#...#..
    .....#...#...............#................#..........................#......#.....................#.......................#.......
    ......................................................##.#....#..................................................................#
    #....#....................#..................................#.....................................#......................#.......
    .......#...........................#.......................#......#...#.................................................#...#.....
    ....................##..........................#................#..........................#.#..................#....#.........#.
    #..................................#...............#...............#.........................#............##......................
    .............................#....................................#...............#.........#..........#.......................#..
    .................................#............###.......#............##......#...............................#...............#.#..
    .#..........................................#.......#.......................##..#........#........#...............#...............
    ......#...#............#.#..............#...................#..........................................................##.........
    #................##....................................................................#........#.................#...#...........
    ...#..........#..........................##......#....#..............................#......................................#.....
    ..............................##.#..........................................................#..............................#......
    ......#...........#....#..................#............#....................................................................#.....
    .....................#........................#.......................................................#...........................
    ...................#.#..........................................................................................#.#...............
    .........................................##.........................................................#.......#...###......#........
    ...............................................................##.......................#..........................#..............
    ...#...........#.................#..............#......#.....#..........................#....................#....#...............
    .................................#................#................#..............................................#.......##.....#
    ........#..........................#................#.......................#...................#.................................
    .............................#.............................#..........#.........................#........#........................
    ....#................#.#................#...........................................................#...#....#......#......#......
    ........#..............................#...............................#.................#........................................
    ...........................................#..#........#...#...........#..#.............#.........................................
    .#.................#.#................................#................#.#..................................#........#............
    .......#..........................................#.................................................................#.............
    ...................#....................................................#..#...............................................#......
    ...#.#........#...#.....#.....................................................................................................#...
    ......#.........................#......................#.............#.....................#......................................
    ..........................#............#.................................#..#..........#........#......................#..........
    ...#..#......#.......................#........................#...................................................................
    ............#...........#................#..............#.........................................................................
    .#........#....#.........................................#........................................#...............................
    ...#......................##.........#.......#.#...........#................................................#...#.................
    ...........#......#.........#....#.....#.......................................................#.............#....................
    .............#...#..............................................#.........#.....##....................#...#.........#.............
    ...............#................................#..........................................#.....#.#.........................#...#
    ................#.....#..#.............#..............#..............#.......#....................................................
    ......#.........................................................................................................#.........##......
    ..#...........................#.#...........................................#..#.....#............................................
    ...#...#..................#..................................#.........#...................#..................................#...
    ............#..#.....................#.........................................#.......#..................................#.......
    ...#.......................................................................#.............................#........................
    ......#..................#....................................#......##...........................................................
    .#...............#.....#..........................................................................................#...............
    ...#.............#.........................#.....................#...#..........#....#............................#...............
    ...#............................#.......#...........#.........#........#.....#...........#...................................#....
    .....................#...................#................................#...............................#......#.........#..##..
    .............#........................................................................................#........................##.
    .....#.......#.......#............................................................................................................
    ............................................#................................................................#..............#.....
    ....#..#......................................................#...................................................#...............
    .................................#...##..................#.................................................#....#.................
    ........#...................................#...#..........................................................#......................
    ........................#........##...........#.......#........#...................................#..............................
    ...........#...#...................................................#..............#......#...............#.#..................#...
    ........#.............................................#...........................................................................
    ........#................#......#..........#..#........#.#.......#...#........................#..#......................#.......#.
    .......#..........................................................................................................#.....#.....#...
    ......................##....................#.....#.................#...........#.......................#.##..........#......#....
    ....................................##....................................................................#.................#.....
    ..#.................................#.#...........#............................................#....#.............................
    #...................................#...........................................#............#.........#...............#..........
    .......................#.............................................................#..........#...#.............#.....#.........
    #..................#.#.............................................................................#.................#............
    .....................#......#.......#...........#..........................................^...............................#......
    ................................#......................#.#.....#..............#..................#....#.#......#....#.............
    ............................................................................#........#.....................................#......
    .............#......................................................#...................................#......##..#....#.........
    ...............#.................#...................#...............#............................................................
    ..............#...........#..#...........................................#...................................#..........#.........
    ..........#...........................#...................#..............#...#.......#..........#...................#.............
    .............#.#..................................#....#..#............#.....................#................#...#.....#.........
    ...................#..........................................................#............##.....................................
    ...........................................#............#........................................................................#
    ..#..............................#....#...........................................................................................
    ..#..#............#...........................#...#...........#............#.....#.................#..............................
    ....#...................#.........#...............................................................................................
    .......#..........................#....................................##........#.................##...#.#........#..#...........
    .#........................#....#.......#.....#...................#.............................................#..................
    ..#...............................................................#................................................#..............
    .....#........................................#...................................................................................
    ..........................................#..........................................................#............................
    ....................###.........................#............................#...#...........#............#.......................
    .....#.....#...............#........#.#....#...................#...........#........#...........#.................................
    ................................................................................................#...##............................
    ......................#............#.........................#.......................#.....#...........#...#.#....................
    ............................#....................#..................#..............#..................................#...........
    ...........................#...................................#..............................................................#...
    ..................#................#.....................#...................#........#..............#............................
    ............#.............#.....................#..................#.........#......................#............#............#...
    ....#..........................#...............................................................................................#..
    ................#.....................................#.............................#...........#........................#........
    #.##...........#.........................................#...............#..........................................#.#...........
    ........................................#..............#.....................#............#.....#.................................
    .......#....##..#..#.....#........................................................................................................
    ....##.............#..............................#...............................................................................
    .....#........................#.........#..#......#........#......................#.......#..............#..........#.......#.....
    ..#....#.........................#.#....................#..#.......#.............#..................#........#..................#.
    ..........##....#........................................................................#........................................
    ........#......#................................................................................................#................#
    .....#.......#...#.............#....................................#..#........................#...#..............#....#.........
    .............#...................................................##...#...........................................................
    ..............#.............................................#.............#................#.............#..............#.........
    ..#....#..........#.....#......#......................#................................#...............................#..........
    .................................................................................##......#...........................#.....#......
    ..#....#..........#.......#.........................................#...............#..#............................#........#....
    ...........#........#.#....................#........#.....................................#..................#....................
    .......#............#................#...........#.............#......#.........#...........................#.....................
    #.#....#.#...............#....#.....#.......................#...............................#...................##...#............
    .................##...#.................................................................#...........................#.............
    .....#........................................#.........#...................................................#.....................
    ....................#.....................#................................................#...##.....................#...........
    ...............#...............................................................#....#.............................................
    .................#................#...#.....................................#......#....................#...............#.#.......
    ...................#............................................#..#....#..#........#...............................#.........#...
    ..#........#...............#..................#.....#..................#.....................................#........##...#......
    .....#.....#....#.....#................#.#.....................##.............................................................#...
    ................#............#......#......#.......................................................#....................#........#
    ........#..............#..#......................................................................##.....##........................
    .........#.............................#.........#.......................................#..........................#.##..........
    .#...................#........................................................#....#......................................#.......
    ....#..........#.....#.........................................................................................#..................
    .......#.............................#............#.........................#....#....#........#......#.....#.......#.............
    ..#.......#........................#........................#.....................................................................
    ........................#...............................#.#.............#................................#..................#....."""

    data = [list(d) for d in data.splitlines()]

    n = len(data)
    m = len(data[0])

    def get_start(data): 
        for i in range(n): 
            for j in range(m):
                if data[i][j] == '^': 
                    return i, j

    start_location = get_start(data)
    data[start_location[0]][start_location[1]] = '.'
    return data, get_start, m, n, start_location


@app.cell
def __(data, m, n, start_location):
    # counts num traversed squares starting at location
    # and returns None if infinite loop
    def get_used_pos(data): 
        direction = (-1, 0)
        location = start_location

        # multiply by 
        # 90 deg rotation 
        # matrix
        def rotate(dir): 
            x, y = dir
            return y, -x

        def in_bounds(location): 
            x, y = location
            return x >= 0 and y >= 0\
                and x < n and y < m

        # 2-vec sum
        def move(loc, direc): 
            return loc[0] + direc[0], loc[1] + direc[1]

        seen = set()
        while in_bounds(location): 
            if data[location[0]][location[1]] == "#": 
                print('bad things')
                
            if (direction, location) in seen: 
                return None
            seen.add((direction, location))
            
            next = move(location, direction)
            if in_bounds(next) and data[next[0]][next[1]] == "#":
                direction = rotate(direction)
            else:
                location = next

        return set(location for _, location in list(seen))

    used_pos = get_used_pos(data)
    print(len(used_pos)) # 4515
    return get_used_pos, used_pos


@app.cell
def __(data, get_used_pos, start_location):
    from copy import deepcopy

    count = 0
    for (i, j) in get_used_pos(data): 
        if data[i][j] == "." and (i, j) != start_location:
            new_data = deepcopy(data)
            new_data[i][j] = "#"
            if not get_used_pos(new_data):   
                count += 1

    print(count) # 1309
    return count, deepcopy, i, j, new_data


@app.cell
def __():
    return


if __name__ == "__main__":
    app.run()
